# The Accessibility Exchange

[![Project license](https://badgen.net/github/license/accessibility-exchange/platform)](https://github.com/accessibility-exchange/platform/releases/latest)
[![Latest release](https://badgen.net/github/release/accessibility-exchange/platform)](https://github.com/accessibility-exchange/platform/releases/latest)
[![Check status](https://badgen.net/github/checks/accessibility-exchange/platform/dev)](https://github.com/accessibility-exchange/platform/actions)
[![Code coverage](https://badgen.net/codecov/c/github/accessibility-exchange/platform)](https://codecov.io/gh/accessibility-exchange/platform/)
[![Localization status](https://badges.crowdin.net/accessibility-in-action/localized.svg)](https://crowdin.com/project/accessibility-in-action)

The Accessibility Exchange is a two-year initiative managed by the
[Institute for Research and Development on Inclusion and Society (IRIS)](https://irisinstitute.ca/) that sets out to
create an online platform which will support processes where people with disabilities have the power to make sure that policies,
programs, and services by federally regulated organizations are accessible to them and respect their human rights. Current
consultation processes are built on a foundation of systemic ableism—they lack accountability, follow-through, and don't
honour the expertise of people with disabilities.

The Accessibility Exchange platform is co-designed and developed by the [Inclusive Design Research Centre](https://idrc.ocadu.ca/)
at [OCAD University](https://ocadu.ca).

## Technical Details

The platform is built as a progressive web application using the [Laravel 8](https://laravel.com/docs/8.x) framework.

## Installation

For general deployment information, please see the Laravel 8.x [deployment documentation](https://laravel.com/docs/8.x/deployment).

The platform requires the following:

-   [PHP](https://www.php.net/supported-versions.php) >= 8.1 with [required extensions](https://laravel.com/docs/8.x/deployment#server-requirements)
-   [MySQL](https://dev.mysql.com/downloads/) >= 5.7
-   [Composer](https://getcomposer.org) >= 2.0

The deployment process should follow all the recommended [optimization processes](https://laravel.com/docs/8.x/deployment#optimization).

## Development environments

In development environments, a deployment should be followed by running a fresh migration and the development database seeder:

```bash
php artisan migrate:fresh --force
php artisan db:seed DevSeeder --force
```

**NOTE: This will overwrite all existing database tables.**

## Production environments

In production environments, a deployment should be followed by running all available migrations:

```bash
php artisan migrate
```

## Development

### Requirements

* [Docker](https://docs.docker.com/engine/install/) engine.  
* [Docker](https://docs.docker.com/compose/install/) compose.
  * This sometimes comes along with docker engine. Run `docker compose version` to test if it exists.  
  * If you have to install separately you will need to replace all the `docker compose` sections with `docker-compose`.  

### Setup Local Development Environment

### Fork & Clone Repository

Fork the repository within Github.  

Clone the repository. (Replace the remote URL with the one from your forked repository)  

```bash
git clone git@github.com:accessibility-exchange/platform.git
cd platform
```

### Setup The .env File

Create a copy of the **.env.example** file.  

```bash
cp .env.example .env
```

To sync the ownership of files within the container and your local system for shared folders you will want to set the numerical used and group within the container to match your own. Run the following commands to put the IDs into the **.env** file.  

```bash
echo -e "WWWUSER=$UID" >> .env
echo -e "WWWGROUP=$GID" >> .env
```

Build the application container so you can run some artisan commands.  

```bash
docker compose build platform.test
```  

Expected output should end in something like the following. You will want to copy this portiong for use in future commands `platform-platform.test`.  

```bash
naming to docker.io/library/platform-platform.test
```

Generate your **APP_KEY** using the built container (remember to replace `platform-platform.test` with the name generated by the build command). This will output a key that you will place into the **.env** file for **APP_KEY**.   

```bash
docker run --rm -it --entrypoint '' platform-platform.test php artisan key:generate --show
```

Generate the **CIPHERSWEET_KEY** using the built container (remember to replace `platform-platform.test` with the name generated by the build command). This will output a key that you will place at the bottom of the **.env** file.  

```bash
docker run --rm -it --entrypoint '' platform-platform.test php artisan ciphersweet:generate-key
```

### Build and Deploy the Containers

You will want to rebuild the application container again with the new **.env** file changes and then deploy all the containers.  

```bash
docker compose build platform.test && docker compose up -d && docker ps -a
```

You should now see output similar to this.  

```bash
CONTAINER ID   IMAGE                         COMMAND                  CREATED          STATUS                    PORTS                                                                                    NAMES
f68b786c3fca   6762be024e6a                  "/bin/sh -c ${APP_HO…"   32 minutes ago   Up 32 minutes             0.0.0.0:443->443/tcp, :::443->443/tcp, 9000/tcp, 0.0.0.0:80->8080/tcp, :::80->8080/tcp   platform.test
c70399bfbf03   selenium/standalone-chrome    "/opt/bin/entry_poin…"   37 minutes ago   Up 37 minutes             4444/tcp, 5900/tcp                                                                       platform-selenium-1
c850a5fc6032   mysql/mysql-server:8.0        "/entrypoint.sh mysq…"   37 minutes ago   Up 37 minutes (healthy)   3306/tcp, 33060-33061/tcp                                                                platform-mysql-1
b2b73189f9a8   mailhog/mailhog:latest        "MailHog"                37 minutes ago   Up 37 minutes             0.0.0.0:1025->1025/tcp, :::1025->1025/tcp, 0.0.0.0:8025->8025/tcp, :::8025->8025/tcp     platform-mailhog-1
338b1ba5aec9   redis:alpine                  "docker-entrypoint.s…"   37 minutes ago   Up 37 minutes (healthy)   6379/tcp                                                                                 platform-redis-1
992997afd38a   getmeili/meilisearch:latest   "tini -- /bin/sh -c …"   37 minutes ago   Up 37 minutes (healthy)   0.0.0.0:7700->7700/tcp, :::7700->7700/tcp                                                platform-meilisearch-1
```  

The application container will take some time to fully deploy since it will be rebuilding the database, seeding it and generate self-signed SSL certs. To view the status of the deployment you can watch the logs of the **platform.test** container.  

```bash
docker logs -f platform.test
```

When you see the following text the container is fully deployed.  

```bash
2022-08-04 16:45:19,386 INFO success: nginx entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2022-08-04 16:45:19,386 INFO success: nginx entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2022-08-04 16:45:19,386 INFO success: php-fpm entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
2022-08-04 16:45:19,386 INFO success: php-fpm entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
```

### Development workflow

-   This project uses [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/), enforced by [commitlint](https://commitlint.js.org/).
    All commit messages and pull request titles must follow these standards.
-   The [`dev`](https://github.com/accessibility-exchange/platform/tree/dev) branch contains refined features
    that have been prototyped and gone through one or more co-design sessions.
-   Feature refinement must take place in a feature branch forked from the `prototype` branch. Feature refinement branches
    must be named according to the format `feat/<feature>`. Once a refined feature is ready to merge into `dev`, the
    merge must be performed using a [squash commit](https://docs.github.com/en/github/collaborating-with-pull-requests/incorporating-changes-from-a-pull-request/about-pull-request-merges#squash-and-merge-your-pull-request-commits).
-   The [`main`](https://github.com/accessibility-exchange/platform/tree/main) branch contains refined features that
    are considered production-ready.
-   Prereleases must be tagged from the `dev` branch.
-   Releases must be tagged from the `main` branch.

## License

The Accessibility Exchange platform is available under the [BSD 3-Clause License](https://github.com/accessibility-exchange/platform/blob/main/LICENSE.md).
